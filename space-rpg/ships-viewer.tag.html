<ships-viewer>

  <div class="list">
    <div><b>Player Ships</b></div>
    <div each={ship in world.ships} onclick={edit} class={ list_item: true, active: ship==selected }>
      {ship.name}
    </div>
    <div><button onclick={addShip}>+ New Ship</button></div>
  </div>

  <div class="list list-2">
    <div><b>Enemy Ships</b></div>
    <div each={ship in world.enemies} onclick={edit} class={ list_item: true, active: ship==selected }>
      {ship.name}
    </div>
    <div><button onclick={addEnemy}>+ New Enemy</button></div>
  </div>

  <div class="sidebar" show={!!selected}>
    <button onclick={makeStartingShip}>Make starting ship</button>
    <input type=text ref="nameField" value={selected && selected.name}>
    <div class="input-grid">
      <em>visual</em>
      <select ref="visualInput">
        <option each={e in world.models}>{e.name}</option>
      </select>
    </div>
    
    <label>Attributes</label>
    <div class="input-grid">
      <em>maxhull</em>   <input type=number step=1 ref="maxhullField" value={selected && selected.attr.maxhull}><br/>
      <em>maxshield</em> <input type=number step=1 ref="maxshieldField" value={selected && selected.attr.maxshield}><br/>
      <em>maxenergy</em> <input type=number step=1 ref="maxenergyField" value={selected && selected.attr.maxenergy}><br/>
      <em>jump</em>      <input type=number step=1 ref="jumpField" value={selected && selected.attr.jump}><br/>
      <em>slots</em>     <input type=number step=1 ref="slotsField" value={selected && selected.attr.slots}><br/>
    </div>
    
    <label>Generators</label>
    <div class="input-grid">
      <em>hull</em>   <input type=number step=1 ref="hullField" value={selected && selected.generator.hull}><br/>
      <em>shield</em> <input type=number step=1 ref="shieldField" value={selected && selected.generator.shield}><br/>
      <em>energy</em> <input type=number step=1 ref="energyField" value={selected && selected.generator.energy}>
    </div>

    <br/>
    <button onclick={remove}>Delete</button>
    <button onclick={endEditing}>Done</button>
    <button onclick={cancelEditing}>Cancel</button>
  </div>

  <battle-simulator />

  <script>
    var self = this

    self.world = { ships: [], enemies: [] }
    self.selected = null

    self.makeStartingShip = function () {
      if (self.selected) self.world.initialShip = self.selected.name
    }

    self.remove = function () {
      self.world.ships = self.world.ships.filter(e => e != self.selected)
      self.world.enemies = self.world.enemies.filter(e => e != self.selected)
    }

    self.addShip = function () {
      self.world.ships.push({
        attr: { maxhull:0, maxshield:0, maxenergy:0, armor:0, cloak:0, jump:0, slots:0},
        generator:{hull:0, shield:0, energy: 0}, name: 'unnamed', visual: 'monitor-drone'})
    }

    self.addEnemy = function () {
      self.world.enemies.push({
        attr: { maxhull:0, maxshield:0, maxenergy:0, armor:0, cloak:0, jump:0, slots:0},
        generator:{hull:0, shield:0, energy: 0},
        name: 'unnamed',
        visual: 'monitor-drone',
        inventory: []
      })
    }
    
    self.edit = function (e) {
      self.selected = e.item.ship
      self.refs.visualInput.value = self.selected.visual
    }
    
    self.endEditing = function (e) {
      self.selected.name = self.refs.nameField.value
      self.selected.visual = self.refs.visualInput.value
      self.selected.attr.maxhull = +self.refs.maxhullField.value
      self.selected.attr.maxshield = +self.refs.maxshieldField.value
      self.selected.attr.maxenergy = +self.refs.maxenergyField.value
      self.selected.attr.jump = +self.refs.jumpField.value
      self.selected.attr.slots = +self.refs.slotsField.value
      self.selected.generator.hull = +self.refs.hullField.value
      self.selected.generator.shield = +self.refs.shieldField.value
      self.selected.generator.energy = +self.refs.energyField.value
      self.selected = null
      self.update()
    }

    self.cancelEditing = function () {
      self.selected = null
      self.update()
    }

    function loadWorld() {
        self.world = getWorld()
        self.update()
    }

    self.on('mount', function() {
      window.events.on('world-updated', loadWorld)
      window.events.on('save-world', () => saveWorld(self.world))
      loadWorld()
    })

  </script>

</ships-viewer>
