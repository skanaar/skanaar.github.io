<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Cluster Platform</title>
	
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

	<link rel="stylesheet" href="css/boilerplate.css">
	<link rel="stylesheet" href="css/cluster.css">
	<link rel="stylesheet" href="css/normalize.css">

	<link rel="shortcut icon" href="img/favicon.png">
	<link rel="apple-touch-icon" href="img/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="img/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="img/apple-touch-icon-114x114.png">
	<style>

		@font-face {
			font-family: 'Dosis';
			font-style: normal;
			font-weight: 400;
			src: local('Dosis Regular'), local('Dosis-Regular'), url(dosis.woff) format('woff');
		}

		.jumbotron {
			background: #0d8;
			font-size: 200%;
			font-family: 'Dosis', sans-serif;
			background: url(img/algae.jpg) center center;
			background-size: cover;
			color: #eee;
			padding: 10px 20px;
			text-align: center;
		}
		.updates {
			background: #eee;
			font-family: 'Dosis', sans-serif;
		}
		.updates .blocks{
			text-align: center;
		}
		.updates .block {
			display: inline-block;
			margin: 0 10px;
			width: 220px;
			text-align: left;
		}
		.updates .block .fa-stack {
			color: #4C9730;
		}
		.updates .block b {
			display: inline-block;
			vertical-align: middle;
			width: 30px;
			font-size: 200%;
			text-align: right
		}
		.updates .block .specifier {
			display: inline-block;
			width: 50px;
			vertical-align: middle;
			margin-left: 10px;
		}
		.profile-summary {
			color: #eee;
			font-family: 'Dosis', sans-serif;
			background: #1C8394;
			padding: 0 20px;
		}
		.profile-summary h2 {
			color: white;
			margin: 0 0 10px 0;
		}
		.profile-summary img {
			border-radius: 146px;
			float: left;
		}
		.profile-summary .properties {
			font-size: 110%;
			padding-left: 20px;
			float: left;
		}
		.profile-summary .properties b{
			font-weight: normal;
			display: block;
			font-size: 80%;
			color: lightgreen;
		}

		.tab_page_clustersearch {
			background: #eee
		}

		.sidebar {
			background: #ccc; 
			color: #333; 
			padding: 10px;
		}

		.overlay_sidebar {
			position: absolute; 
			top: 0; 
			width: 200px; 
			height: 100%; 
			background: rgba(0, 0, 0, 0.5); 
			padding: 0px;
			color: #eee;
			font-family: 'Dosis', sans-serif;
		}
		.details_sidebar {
			display: none;
			right: 0; 
		}
		.search_sidebar {
			display: none;
			left: 0; 
			background: rgba(64, 64, 64, 0.75); 
		}

		.overlay_sidebar>div {
			margin: 10px
		}
		.overlay_sidebar h2 {
			color: #8f8;
		}

	</style>
</head>
<body>
	<div class="page">

		<div class="full-row page-stripe">
			<div class="pull-right">
				<a class="tab_link tab_link_dashboard" href="#dashboard">
					<i class="fa fa-home"></i> <span class="hidden-sm">Dashboard</span>
				</a>
				<a class="tab_link tab_link_clustersearch" href="#clustersearch">
					<i class="fa fa-search"></i> <span class="hidden-sm">Search</span>
				</a>
				<a class="tab_link tab_link_cluster" href="#cluster">
					<i class="fa fa-bullseye"></i> <span class="hidden-sm">Explorer</span>
				</a>
				<a href="javascript:void(0)"><i class="fa fa-power-off"></i></a>
			</div>
			<div class="title">
				Cluster Platform for Transformative Solutions
			</div>
		</div>

		<div class="tab_page tab_page_cluster">
			<div class="full-row page-stripe toolbar">
				<div class="pull-right">
					<a onclick="engine.togglePause()">
						<i class="fa fa-pause"></i></a>
					<a id="download-image-link" download="cluster-snapshot.png">
						<i class="fa fa-camera"></i></a>
					<a onclick="engine.zoom(-1)" href="javascript:void(0)">
						<i class="fa fa-plus"></i></a>
					<a onclick="engine.zoom(1)" href="javascript:void(0)">
						<i class="fa fa-minus"></i></a>
				</div>
				<div>
					<label>Filter</label>
					<a class="filter-option filter-r" onclick="engine.filter('r')" href="javascript:void(0)">Mobility</a>
					<a class="filter-option filter-g" onclick="engine.filter('g')" href="javascript:void(0)">Nutrition</a>
					<a class="filter-option filter-b" onclick="engine.filter('b')" href="javascript:void(0)">Building</a>
				</div>
			</div>
			<div style="position: relative">
				<canvas id="canvas" width="800" height="800"></canvas>
				<div class="overlay_sidebar details_sidebar" id="node_details_sidebar">
					<div>
						<div>
							<a class="pull-right"
							   onclick="engine.centerSelected()" 
							   href="javascript:void(0)">
								<i class="fa fa-crosshairs fa-2x"></i>
							</a>
							<h2><span class="bind-name"></span> </h2>
						</div>
						<div class="bind-description"></div>
						<div class="page-stripe toolset"><label>Id:</label> <span class="bind-id"></span></div>

						<hr>

						<div class="page-stripe toolset">
							<label>Paint</label>
							<a onclick="engine.paint('r')" href="javascript:void(0)">R</a>
							<a onclick="engine.paint('g')" href="javascript:void(0)">G</a>
							<a onclick="engine.paint('b')" href="javascript:void(0)">B</a>
						</div>
					</div>
				</div>
				<div class="overlay_sidebar search_sidebar" id="search_sidebar">
					<div>
						<input placeholder="search">
						<hr>
						<div><label><input type="checkbox"> Mobility</label></div>
						<div><label><input type="checkbox" checked> Nutrition</label></div>
						<div><label><input type="checkbox"> Building</label></div>
						<h4>Minimum size: 64 <input type="range" placeholder="search"></h4>
					</div>
				</div>
			</div>
		</div>

		<div class="tab_page tab_page_clustersearch">

			<div class="full-row jumbotron">
				Cluster Search
			</div>

			<div class="row" ng-app="cluster" ng-controller="SearchCtrl">
				<div class="column width4 sidebar">
					<div><input type="text" ng-model="search" placeholder="Search"></div>
					<hr>
					<div>
						<label><input type="checkbox" ng-model="filters.mobility"> Mobility</label>
					</div>
					<div>
						<label><input type="checkbox" ng-model="filters.nutrition"> Nutrition</label>
					</div>
					<div>
						<label><input type="checkbox" ng-model="filters.building"> Building</label>
					</div>
				</div>
				<div class="column width8">
					<h2>Results</h2>
					<table style="width: 100%">
					<tr ng-repeat="s in orderedSolutions() | filter:search">
						<td><a href="#cluster/{{s.id}}">{{s.name}}</a></td>
						<td><small>Mobility: {{s.properties.mobility}}</small></td>
						<td><small>Nutrition: {{s.properties.nutrition}}</small></td>
						<td><small>Building: {{s.properties.building}}</small></td>
					</tr>
					</table>
				</div>
			</div>

		</div>

		<div class="tab_page tab_page_dashboard">

			<div class="full-row jumbotron">
				Dashboard
			</div>

			<div class="row">
				<div class="column width8 updates">
					<h2>Updates</h2>
					<div class="blocks">
						<div class="block">
							<span class="fa-stack fa-2x">
						  		<i class="fa fa-circle fa-stack-2x"></i>
						  		<i class="fa fa-thumbs-up fa-stack-1x fa-inverse"></i>
							</span>
							<b>14</b><div class="specifier">likes</div>
						</div>
						<div class="block">
							<span class="fa-stack fa-2x">
						  		<i class="fa fa-circle fa-stack-2x"></i>
						  		<i class="fa fa-bolt fa-stack-1x fa-inverse"></i>
							</span>
							<b>6</b><div class="specifier">opportunities</div>
						</div>
						<div class="block">
							<span class="fa-stack fa-2x">
						  		<i class="fa fa-circle fa-stack-2x"></i>
						  		<i class="fa fa-rss fa-stack-1x fa-inverse"></i>
							</span>
							<b>32</b><div class="specifier">news flashes</div>
						</div>
						<div class="block">
							<span class="fa-stack fa-2x">
						  		<i class="fa fa-circle fa-stack-2x"></i>
						  		<i class="fa fa-lightbulb-o fa-stack-1x fa-inverse"></i>
							</span>
							<b>7</b><div class="specifier">ideas for you</div>
						</div>
						<div class="block">
							<span class="fa-stack fa-2x">
						  		<i class="fa fa-circle fa-stack-2x"></i>
						  		<i class="fa fa-link fa-stack-1x fa-inverse"></i>
							</span>
							<b>3</b><div class="specifier">possible connections</div>
						</div>
						<div class="block">
							<span class="fa-stack fa-2x">
						  		<i class="fa fa-circle fa-stack-2x"></i>
						  		<i class="fa fa-link fa-stack-1x fa-inverse"></i>
							</span>
							<b>3</b><div class="specifier">possible connections</div>
						</div>
					</div>
				</div>
				<div class="column width4 profile-summary">
					<h2>Marie Fredricks</h2>
					<img src="img/profiles/marie.jpg" width=100 height=100>
					<div class="properties">
						<div><b>Profile</b> Entrepreneur</div>
						<div><b>Segment</b> Nutrition</div>
					</div>
				</div>
			</div>

		</div>

		<div class="full-row footer page-stripe">
			<div class="title">
				21st Century Frontiers 2014
			</div>
		</div>
	</div>

	<script src="jquery.js"></script>
	<script src="underscore.js"></script>
	<script src="angular.js"></script>
	<script src="webapp.js"></script>
	<script src="canvas.js"></script>
	<script src="nodes.js"></script>
	<script src="engine.js"></script>
	<script>

	(function (){
		var link = document.getElementById('download-image-link')
		link.addEventListener('click', downloadImage, false);
		function downloadImage(){
			var url = document.getElementById('canvas').toDataURL('image/png')
			var downloadUrl = url.replace(/^data:image\/[^;]/, 'data:application/octet-stream')
		    link.href = downloadUrl;
		}
	}())

	function selectEntity(e){
		$('#node_details_sidebar').show()
		bindData('node_details_sidebar', e)
	}
	function deselectEntity(e){
		$('#node_details_sidebar').hide()
	}

	function entityFactory(r,g,b){
		return function(i){
			return {
				id:_.uniqueId(),
				name: randomName(),
				properties: {
					status: _.sample(['existing', 'supporting', 'potential']),
					type: _.sample(['core', 'accelerator', 'expander']),
	                mobility: _.random(100),
	                nutrition: _.random(100),
	                building: _.random(100)
				}
			}
		}
	}
	var clusters = _.times(5, function (i){
		var es = _.times(10, entityFactory(Math.random(), Math.random(), Math.random()))
		var rs = fillTree(function (a,b){
			return {start:a, end:b, type: _.sample(['core', 'accelerator', 'expander'])}
		}, 3, es)
		return { entities: es, relations: rs }
	})
	var entities = _.flatten(_.pluck(clusters, 'entities'))
	var relations = _.flatten(_.pluck(clusters, 'relations'))
	function fillTree(factory, branches, nodes){
		var accumulator = []
		var pointer = 1
		for(var index=0; pointer<nodes.length; index++){
			var b = _.random(2, branches)
			for(var i=0; i<b && pointer<nodes.length-i; i++)
				accumulator.push(factory(nodes[index], nodes[pointer+i]))
			pointer+=b
		}
		return accumulator
	}


	var nodes = Nodes(10, entities, relations)
	var engine = Engine('canvas', nodes, {
		fps: 30,
		selectEntity: selectEntity,
		deselectEntity: deselectEntity
	})

	window.addEventListener('resize', _.throttle(engine.fillScreen, 750, {leading: true}))
	document.getElementById('canvas').addEventListener('wheel', function (e){ engine.zoom(e.deltaY) })

	var viewChangeHandlers = {
		cluster: function (path, clusterId){
			engine.fillScreen()
			if (clusterId){
				engine.select(clusterId)
				engine.centerSelected()
			}
		}
	}

	fragmentRouting('dashboard', viewChangeHandlers)

	</script>
</body>
</html>